<!-- <h2 class="pt-3 pb-2 mb-3 border-bottom">Dữ liệu môi trường</h2> -->

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Dữ liệu môi trường</h1>
</div>

<div class="table-responsive small">
    <table class="table table-striped table-sm" id="env-table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Độ ẩm</th>
                <th scope="col">PM2.5</th>
                <th scope="col">Amoniac (NH<sub>3</sub>)</th>
                <th scope="col">Mùi trứng thối (H<sub>2)</sub>S</th>
            </tr>
        </thead>
        <tbody>
            <% envData.forEach((env) => { %>
                <tr>
                    <td><%= formatDateTimeVN(env.timestamp) %></td>
                    <td><%= env.hum %></td>
                    <td><%= env.pm25 %></td>
                    <td><%= env.nh3 %></td>
                    <td><%= env.h2s %></td>
                </tr>
            <% }) %>
        </tbody>
    </table>
</div>


<script>
  // Hàm format timestamp sang giờ Việt Nam
  function formatDateTimeVN(dateStr) {
    const d = new Date(dateStr);
    return d.toLocaleString("vi-VN", {
      timeZone: "Asia/Ho_Chi_Minh",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      day: "2-digit",
      month: "numeric",
      year: "numeric"
    }).replace(",", "");
  }

  // Khi server bắn dữ liệu mới
  socket.on("new_environment", (env) => {
    const table = document.querySelector("#env-table tbody");
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${formatDateTimeVN(env.timestamp)}</td>
      <td>${env.hum}</td>
      <td>${env.pm25}</td>
      <td>${env.nh3}</td>
      <td>${env.h2s}</td>
    `;
    table.prepend(row); // thêm lên đầu
  });
</script>
